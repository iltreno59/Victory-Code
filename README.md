# Парсер данных с сайта polkrf.ru

## Описание

Этот проект предназначен для массового скачивания медиа и метаданных о ветеранах с сайта [https://polkrf.ru](https://polkrf.ru) с сохранением:
- изображений ветеранов в директорию `images/`
- детальной информации о каждом ветеране в файл `metadata.jsonl` в формате JSON Lines (каждая строка — отдельный ветеран)

Парсер поддерживает запуск как напрямую в Python, так и в виде Docker-контейнера.

## Требования
- Python 3.10+
- pip install:
  - requests
  - beautifulsoup4
  - urllib3

Для Docker: только установленный и запущенный Docker.

## Запуск в Python

```bash
pip install requests beautifulsoup4 urllib3
python parse_polrkrf.py [опции]
```

### Примеры:

- Скачать 1000 записей с 1-й страницы вперёд, с задержкой 1.5 сек:
  ```bash
  python parse_polrkrf.py -n 1000 -s 1 -d 0 -l 1.5
  ```
- Скачать 2000 записей, начиная с 30-й страницы в обратном порядке:
  ```bash
  python parse_polrkrf.py --num-images 2000 --start-page 30 --direction -1 --delay 1
  ```

### Опции командной строки

| Аргумент         | Короткая | Тип    | По умолчанию | Описание                                      |
|------------------|----------|--------|--------------|-----------------------------------------------|
| --num-images     |   -n     | int    |    100       | Сколько всего изображений/ветеранов выгрузить  |
| --start-page     |   -s     | int    |      1       | С какой страницы сайта начинать обработку      |
| --direction      |   -d     | 0,-1   |      0       | 0 — вперёд, -1 — обратно по страницам          |
| --delay          |   -l     | float  |    0.5       | Задержка между всеми сетевыми запросами, сек   |

Порядок аргументов не важен; можно указывать только нужные опции.

### Результат
- Все изображения сохраняются в подпапку `images/`
- Информация по каждому ветерану строчно добавляется в `metadata.jsonl` (UTF-8, JSONL)
- При прерывании или сбое уже собранные строки не теряются

## Запуск с помощью Docker

### 1. Сборка Docker-образа
Выполните эту команду в корне репозитория, где лежит `Dockerfile`:

```bash
docker build -t polkrf-dataset:1.3 .
```

### 2. Запуск контейнера с примонтированием файлов

Все результаты удобно сохранять в локальные файлы/директории (на вашем компьютере). Используйте ключ `-v` (mount volume) для папки с изображениями и файла metadata.

#### Пример для Windows PowerShell:
```powershell
docker run --rm \
  -v "${PWD}\images:/app/images" \
  -v "${PWD}\metadata.jsonl:/app/metadata.jsonl" \
  polkrf-dataset:1.3 -n 1000 -s 1 -d 0 -l 1
```

#### Пример для Linux/macOS (bash):
```bash
docker run --rm \
  -v "$PWD/images:/app/images" \
  -v "$PWD/metadata.jsonl:/app/metadata.jsonl" \
  polkrf-dataset:1.3 -n 1000 -s 1 -d 0 -l 1
```

- Здесь:
  - `-n 1000` — сколько изображений (можно другое число)
  - `-s 1` — с какой страницы начать (например, `-s 10`)
  - `-d -1` — в обратном порядке (или `-d 0` — прямой обход)
  - `-l 0.5` — задержка между запросами (сек)

### 3. Полные примеры команд

- Стандартно, вперёд:
```bash
docker run --rm -v "$PWD/images:/app/images" -v "$PWD/metadata.jsonl:/app/metadata.jsonl" polkrf-dataset:1.3 -n 500
```
- Начать с 40-й страницы в обратном порядке:
```bash
docker run --rm -v "$PWD/images:/app/images" -v "$PWD/metadata.jsonl:/app/metadata.jsonl" polkrf-dataset:1.3 -n 200 -s 40 -d -1 -l 1.2
```
- Больший delay и больше данных:
```bash
docker run --rm -v "$PWD/images:/app/images" -v "$PWD/metadata.jsonl:/app/metadata.jsonl" polkrf-dataset:1.3 -n 2000 -l 2
```

### 4. Где искать данные
- Все скачанные изображения будут в поддиректории `images` в вашей папке, где запускали контейнер.
- Все метаданные — в `metadata.jsonl`, по одной записи на строку.

### 5. Как обновить образ для новой версии скрипта
- После изменений кода сборку надо повторить с новым тегом!
```bash
docker build -t polkrf-dataset:1.4 .
```
- Запуск с новым тегом:
```bash
docker run --rm ... polkrf-dataset:1.4 ...
```

### 6. Публикация своего образа на Docker Hub
- Залогиньтесь: `docker login`
- Протегируйте образ с вашим логином:
```bash
docker tag polkrf-dataset:1.4 yourdockerhub/polkrf-dataset:1.4
```
- Загрузите:
```bash
docker push yourdockerhub/polkrf-dataset:1.4
```

### 7. Запуск на другом компьютере через Docker Hub

Если вы загрузили образ на Docker Hub, для запуска на другом компьютере:

1. Получите образ из Docker Hub:
   ```bash
   docker pull yourdockerhub/polkrf-dataset:1.4
   # или с индексом вашей версии
   ```
2. Убедитесь, что в вашей рабочей директории есть (или создайте):
   - папка `images/`
   - файл `metadata.jsonl` (или он будет создан автоматически при запуске)

3. Запустите контейнер с нужными вам параметрами (например, 500 изображений, с 10-й страницы, в обратном порядке, задержка 2 сек):

- Bash / Linux / macOS:
```bash
docker run --rm \
  -v "$PWD/images:/app/images" \
  -v "$PWD/metadata.jsonl:/app/metadata.jsonl" \
  yourdockerhub/polkrf-dataset:1.4 -n 500 -s 10 -d -1 -l 2
```

- Windows PowerShell:
```powershell
docker run --rm `
  -v "${PWD}\images:/app/images" `
  -v "${PWD}\metadata.jsonl:/app/metadata.jsonl" `
  yourdockerhub/polkrf-dataset:1.4 -n 500 -s 10 -d -1 -l 2
```

4. После завершения работы контейнера проверьте директорию:
   - Все изображения — в папке images
   - Все метаданные — в файле metadata.jsonl

> **Важно:**
> - Для новой версии просто выполните `docker pull yourdockerhub/polkrf-dataset:<новый_тег>` и используйте его имя в запуске.
> - Параметры командной строки и использование полностью такие же, как при локальном запуске — только используйте ваш remote-образ.
> - Не забудьте заранее смонтировать output-файлы/директории!

---

**Совет:** для воспроизводимости всегда используйте явный тег (1.3, 1.4...) — так у вас точно не будет путаницы между версиями!

## Советы и рекомендации
- Используйте больший delay (`--delay 1.5` или выше) чтобы не перегружать сервер.
- Для перезапуска после сбоя можно увеличить/уменьшить start_page и пробовать нужное направление.
- Проверяйте достаточно ли свободного места для папки изображений и jsonl-файла.
- Если хотите использовать docker-compose, опишите тома (`volumes`) для images и metadata.jsonl явно.

---
Проект предназначен только для исследовательских и этических целей! Не используйте для создания массивных публичных списков без согласия источника.
